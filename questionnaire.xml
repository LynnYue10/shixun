<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aim.questionnaire.dao.QuestionnaireMapper">
  <resultMap id="BaseResultMap" type="com.aim.questionnaire.dao.entity.Questionnaire">
    <id column="id" jdbcType="VARCHAR" property="id" />
    <result column="name" jdbcType="VARCHAR" property="questionName" />
    <result column="status" jdbcType="VARCHAR" property="status" />
    <result column="project_id" jdbcType="VARCHAR" property="projectId" />
  </resultMap>
  <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="com.aim.questionnaire.dao.entity.ProjectEntity">

  </resultMap>

  <select id="selectByProjectId" resultType="java.lang.Integer">
    select count(1) from questionnaire where project_id = #{id} and status =1
  </select>
  
  <!-- 删除未被删除且未发送的问卷 -->
<!--   <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
   
    delete from questionnaire_info
    where id = #{id,jdbcType=VARCHAR}
    AND question_stop != '1'
  </delete> -->
  
   <insert id="addQuestionnaire" parameterType="map">
   	insert into questionnaire(id,questionName,status,project_id,questionContent,startTime,endTime,releaseTime,dataId,question,questionTitle,isdelete,groupname,username) values
 	(#{id},#{questionName},#{status},#{projectId},#{questionContent},#{startTime},#{endTime},#{releaseTime},#{dataId},#{question},#{questionTitle},#{isdelete},#{groupname},#{username})
   </insert>
  
   <!-- 获取项目下问卷列表 --> 
 	<select id="queryQuestionnaireByProjectId" parameterType="map" resultType="java.util.Map">
 		select id,questionName,status,project_id as projectId,questionContent,startTime,releaseTime,endTime,question,questionTitle
 		from questionnaire
 		where project_id = #{projectId}
 	</select>
 	
 	<!--查询所有问卷-->
    <select id="selectAllQuestionnaire" resultType="java.util.Map">
        SELECT
            id,questionName,status,project_id as projectId,questionContent,startTime,releaseTime,endTime,dataId,question,questionTitle,isdelete,groupname,username
        FROM questionnaire
        WHERE isdelete = "0"
    </select>
    
    <!--查询所有未被删除的问卷-->
    <select id="queryQuestionnaireList" parameterType="map" resultType="java.util.Map">
        SELECT
            id,questionName,status,project_id as projectId,questionContent,startTime,releaseTime,endTime,dataId,question,questionTitle,isdelete,groupname,username
        FROM questionnaire
        WHERE isdelete = "0"
    </select>
    
    <!--查询所有被删除的问卷-->
    <select id="queryDeletedQuestionnaireList" parameterType="map" resultType="java.util.Map">
        SELECT
            id,questionName,status,project_id as projectId,questionContent,startTime,releaseTime,endTime,dataId,question,questionTitle,isdelete,groupname,username
        FROM questionnaire
        WHERE isdelete = "1"
    </select>
    
    <!--模糊查询未被删除的问卷-->
    <select id="queryQuestionnaireByName" parameterType="map" resultType="java.util.Map">
        SELECT
            id,questionName,status,project_id as projectId,questionContent,startTime,releaseTime,endTime,dataId,question,questionTitle,isdelete,groupname,username
        FROM questionnaire
        WHERE  isdelete = "0" AND questionName like '%${questionnaireName}%'
    </select>
    
    <!--模糊查询被删除的问卷-->
    <select id="queryDeletedQuestionnaireByName" parameterType="map" resultType="java.util.Map">
        SELECT
            id,questionName,status,project_id as projectId,questionContent,startTime,releaseTime,endTime,dataId,question,questionTitle,isdelete,groupname,username
        FROM questionnaire
        WHERE  isdelete = "1" AND questionName like '%${questionnaireName}%'
    </select>
    
  <!-- 获取未被删除的问卷的id -->
  <select id="selectQuestionnaireById" parameterType="java.lang.String" resultType="map">
        SELECT
            id AS id, 
            project_id AS projectId,
            questionName AS questionName,
            questionContent AS questionContent,
            dataId AS dataId,
            status AS status,
            releaseTime AS releaseTime,
            startTime AS startTime,
            endTime AS endTime,
            question AS question,
            questionTitle AS questionTitle,
            isdelete AS isdelete,
            groupname AS groupname,
            username AS username
        FROM questionnaire
        WHERE id = #{id,jdbcType=VARCHAR} AND isdelete="0"
    </select>
    
      <!-- 获取未被删除的问卷的id -->
  <select id="selectDeletedQuestionnaireById" parameterType="java.lang.String" resultType="map">
        SELECT
            id AS id, 
            project_id AS projectId,
            questionName AS questionName,
            questionContent AS questionContent,
            dataId AS dataId,
            status AS status,
            releaseTime AS releaseTime,
            startTime AS startTime,
            endTime AS endTime,
            question AS question,
            questionTitle AS questionTitle,
            isdelete AS isdelete,
            groupname AS groupname,
            username AS username
        FROM questionnaire
        WHERE id = #{id,jdbcType=VARCHAR} AND isdelete="1"
    </select>
  
  <update id="modifyQuestionnaireInfo" parameterType="com.aim.questionnaire.dao.entity.Questionnaire">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update questionnaire
        <set>
            <if test="projectId != null">
                project_id = #{projectId,jdbcType=VARCHAR},
            </if>
            <if test="questionName != null">
                questionName = #{questionName,jdbcType=VARCHAR},
            </if>
            <if test="questionContent != null">
                questionContent = #{questionContent,jdbcType=VARCHAR},
            </if>
            <if test="dataId != null">
                dataId = #{dataId,jdbcType=VARCHAR},
            </if>
            
            <if test="status != null">
                status = #{status,jdbcType=VARCHAR},
            </if>
            
            <if test="releaseTime != null">
                releaseTime = #{releaseTime,jdbcType=TIMESTAMP},
            </if>
            <if test="startTime != null">
                startTime = #{startTime,jdbcType=TIMESTAMP},
            </if>
            <if test="endTime != null">
                endTime = #{endTime,jdbcType=TIMESTAMP},
            </if>
            <if test="question != null">
                question = #{question,jdbcType=LONGVARCHAR},
            </if>
            <if test="questionTitle != null">
                questionTitle = #{questionTitle,jdbcType=LONGVARCHAR},
            </if>
            <if test="isdelete != null">
                isdelete = #{isdelete,jdbcType=VARCHAR},
            </if>
            <if test="groupname != null">
                groupname = #{groupname,jdbcType=VARCHAR},
            </if>
            <if test="username != null">
                username = #{username,jdbcType=VARCHAR},
            </if>
        </set>
        where id = #{id,jdbcType=VARCHAR}
    </update>
    
 <!--根据问卷id删除问卷-->
  <delete id="deleteQuestionnaireById" parameterType="com.aim.questionnaire.dao.entity.Questionnaire">
  <!--"java.lang.String"-->
  DELETE
  FROM questionnaire
  WHERE id = #{id,jdbcType=VARCHAR}
  </delete>
  <update id="updateByPrimaryKeySelective" parameterType="com.aim.questionnaire.dao.entity.Questionnaire">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update questionnaire
    <set>
      <if test="projectId != null">
        project_id = #{projectId,jdbcType=VARCHAR},
      </if>
      <if test="questionName != null">
        questionName = #{questionName,jdbcType=VARCHAR},
      </if>
      <if test="questionContent != null">
        questionContent = #{questionContent,jdbcType=VARCHAR},
      </if>
      <if test="dataId != null">
        dataId = #{dataId,jdbcType=VARCHAR},
      </if>
      <if test="questionTitle != null">
        questionTitle = #{questionTitle,jdbcType=VARCHAR},
      </if>
      <if test="releaseTime != null">
        releaseTime = #{releaseTime,jdbcType=TIMESTAMP},
      </if>
      <if test="startTime != null">
        startTime = #{startTime,jdbcType=TIMESTAMP},
      </if>
      <if test="endTime != null">
        endTime = #{endTime,jdbcType=TIMESTAMP},
      </if>
      <if test="question != null">
        question = #{question,jdbcType=LONGVARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  
   <delete id="deleteModel" parameterType="com.aim.questionnaire.dao.entity.Questionnaire">
  DELETE
  FROM questionnaire
  WHERE id = #{id,jdbcType=VARCHAR}
  </delete>
  
  <select id="queryUserList" parameterType="java.lang.String" resultType="java.util.Map">
    SELECT questionName,questionContent,groupName
    FROM questionnaire
    WHERE groupName = #{groupName,jdbcType=VARCHAR} OR groupName = "所有组"
  </select>
</mapper>
